<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-UCGD-Cloud/version_1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Pipeline | UCGD Core</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ucgd.github.io/Core-Docs/docs/UCGD-Cloud/version_1"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Pipeline | UCGD Core"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/Core-Docs/img/ucgd.png"><link data-rh="true" rel="canonical" href="https://ucgd.github.io/Core-Docs/docs/UCGD-Cloud/version_1"><link data-rh="true" rel="alternate" href="https://ucgd.github.io/Core-Docs/docs/UCGD-Cloud/version_1" hreflang="en"><link data-rh="true" rel="alternate" href="https://ucgd.github.io/Core-Docs/docs/UCGD-Cloud/version_1" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Core-Docs/blog/rss.xml" title="UCGD Core RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Core-Docs/blog/atom.xml" title="UCGD Core Atom Feed"><link rel="stylesheet" href="/Core-Docs/assets/css/styles.0b4abc8a.css">
<link rel="preload" href="/Core-Docs/assets/js/runtime~main.386b42ae.js" as="script">
<link rel="preload" href="/Core-Docs/assets/js/main.94abe2e7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Core-Docs/"><div class="navbar__logo"><img src="/Core-Docs/img/logo.svg" alt="UCGD Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Core-Docs/img/logo.svg" alt="UCGD Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">UCGD Core</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Core-Docs/docs/Homepage">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/UCGD/Core-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Core-Docs/docs/Homepage">Homepage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Core-Docs/docs/CHPC_Guide/Data_Retirement_Policy">CHPC_Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Core-Docs/docs/Public-Datasets/1000G">Public-Datasets</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Core-Docs/docs/UCGD-Cloud/ami_setup_guide">UCGD-Cloud</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Core-Docs/docs/UCGD-Cloud/ami_setup_guide">AMI Setup Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Core-Docs/docs/UCGD-Cloud/ucgd_calypso_pipeline_guide">Calypso Re-Annotation Pipeline Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Core-Docs/docs/UCGD-Cloud/ucgd_var_pipeline_guide">VAR Pipeline Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Core-Docs/docs/UCGD-Cloud/version_1">Pipeline</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Core-Docs/docs/UCGD-Pipeline/introduction">UCGD-Pipeline</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Core-Docs/docs/UCGD-Projects/setup">UCGD-Projects</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Core-Docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">UCGD-Cloud</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Pipeline</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Pipeline</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h3><p>This first version of the AWS UCGD-Cloud Pipeline is designed for variant reannotation of existing VCF data files using the Mosaic Calypso pipeline. It is an independent pipeline and is built using our existing <a href="https://github.com/UCGD/UCGD-Pipeline" target="_blank" rel="noopener noreferrer">UCGD-Pipeline</a> software base.</p><p>To process data in the cloud, <code>pcluster</code> is used to build the AWS infrastructure. An AMI startup script provisions the necessary <code>EC2</code> compute instance, and the same AMI is used to create a <code>pcluster</code> image for the <code>AWS CloudFormation</code> stack via <code>pcluster create-cluster</code>.</p><p>This configuration closely aligns with our current CHPC setup, though modifications to both Nextflow processes and configuration files are required.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="aws-setup-and-pcluster-configuration">AWS setup and pcluster configuration<a href="#aws-setup-and-pcluster-configuration" class="hash-link" aria-label="Direct link to AWS setup and pcluster configuration" title="Direct link to AWS setup and pcluster configuration">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iam-user-setup-for-aws-parallelcluster">IAM User Setup for AWS ParallelCluster<a href="#iam-user-setup-for-aws-parallelcluster" class="hash-link" aria-label="Direct link to IAM User Setup for AWS ParallelCluster" title="Direct link to IAM User Setup for AWS ParallelCluster">​</a></h3><p>To follow AWS best practices, create a dedicated IAM user with the appropriate permissions for using <code>AWS ParallelCluster</code>:</p><ul><li>Review the <a href="https://docs.aws.amazon.com/parallelcluster/latest/ug/iam-roles-in-parallelcluster-v3.html" target="_blank" rel="noopener noreferrer">official AWS documentation</a> for an overview of the necessary IAM permissions. Pay special attention to the <code>iam:PassRole</code> permission.</li><li>For detailed guidance on configuring permissions specific to your compute environment and needs, see the <a href="https://docs.aws.amazon.com/parallelcluster/latest/ug/iam-roles-in-parallelcluster-v3.html#iam-roles-in-parallelcluster-v3-params-for-iam" target="_blank" rel="noopener noreferrer">ParallelCluster configuration section</a>.</li><li>AWS offers a good starting point to test correct <code>pcluster</code> configuration <a href="https://docs.aws.amazon.com/parallelcluster/latest/ug/iam-roles-in-parallelcluster-v3.html#iam-roles-in-parallelcluster-v3-base-user-policy" target="_blank" rel="noopener noreferrer">policies</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-and-subnets">VPC and Subnets<a href="#vpc-and-subnets" class="hash-link" aria-label="Direct link to VPC and Subnets" title="Direct link to VPC and Subnets">​</a></h3><p>For optimal security and performance, use:</p><ul><li>Public VPC and subnet for head node access.</li><li>Private VPC and subnet for compute nodes.</li><li>Please review detailed instructions for creating both private and public <a href="https://docs.aws.amazon.com/vpc/latest/userguide/create-vpc.html" target="_blank" rel="noopener noreferrer">VPC</a> and <a href="https://docs.aws.amazon.com/vpc/latest/userguide/configure-subnets.html" target="_blank" rel="noopener noreferrer">Subnet</a> needed for your compute environment.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pcluster">pcluster<a href="#pcluster" class="hash-link" aria-label="Direct link to pcluster" title="Direct link to pcluster">​</a></h3><p>For our implementation, a simple <code>t2.micro</code> instance stores the <code>pcluster</code> configuration files, initiates the <code>AWS CloudFormation</code> stack, and provides easy access to the head node via <code>pcluster ssh</code> command. This instance can be left running or started as needed.</p><p><strong><em>While idle, a HeadNode and a ComputeNode will remain running.</em></strong></p><p>Additionally, two versions of the <code>pcluster create-cluster</code> configuration file are available and are constantly evolving:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Region: us-west-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Os: alinux2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HeadNode:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  InstanceType: m5a.xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Networking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SubnetId: subnet-&lt;PUBLIC SUBNET&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ssh:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KeyName: &lt;IAM ACCESS KEYS&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LocalStorage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RootVolume:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Size: 150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CustomAmi: &lt;UCGD SPECIFIC AMI&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scheduling:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Scheduler: slurm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SlurmQueues:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - Name: ucgd-standard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComputeResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Name: m5-3large</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Instances:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - InstanceType: m5a.2xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MinCount: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MaxCount: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CapacityType: ONDEMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Networking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubnetIds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - subnet-&lt;PRIVATE SUBNET&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CustomAmi: &lt;UCGD SPECIFIC AMI&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - Name: ucgd-24xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComputeResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Name: ucgd-xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Instances:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - InstanceType: m7i.8xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MinCount: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MaxCount: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CapacityType: ONDEMAND</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Networking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubnetIds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - subnet-&lt;PRIVATE SUBNET&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CustomAmi: &lt;UCGD SPECIFIC AMI&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SharedStorage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Name: UCGDEFS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StorageType: Efs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MountDir: /common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EfsSettings:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FileSystemId: &lt;EFS ID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below is an example of an addition added to the above configuration file when requesting AWS SPOT instances.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    - Name: ucgd-24xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComputeResources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Name: ucgd-xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Instances:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - InstanceType: m5n.24xlarge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MinCount: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          MaxCount: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CapacityType: SPOT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      AllocationStrategy: price-capacity-optimized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Networking:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SubnetIds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - subnet-0f780c14d0d08f90f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Image:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CustomAmi: ami-0714acd72001c3e34</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>Additionally, the UCGD specific AMI can be supplied or built using the supplied <code>ucgd-cluster-setup.sh</code> script.</em></strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-configurations">Key configurations:<a href="#key-configurations" class="hash-link" aria-label="Direct link to Key configurations:" title="Direct link to Key configurations:">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">* CapacityType: Supports both ONDEMAND and SPOT instances (listed above).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* HeadNode InstanceType: m5.large (suggested).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* ComputeNode InstanceType: should and can change based on compute type.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* SharedStorage: EFS, providing elastic storage that scales as needed for genomic processing.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>During testing, the <code>m5.large</code> node was selected as smaller options did not allow the AMI build process enough memory to complete.</em></strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ecr">ECR<a href="#ecr" class="hash-link" aria-label="Direct link to ECR" title="Direct link to ECR">​</a></h3><p>Most <code>nextflow</code> processes use <code>Docker</code> images stored in <code>AWS ECR</code>. The following containers are currently in use:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/bcftools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/calypso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/calypso-slivar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/fqf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/glnexus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ucgd/ucgd_utils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="efs">EFS<a href="#efs" class="hash-link" aria-label="Direct link to EFS" title="Direct link to EFS">​</a></h3><p>After testing, an <a href="https://aws.amazon.com/efs/" target="_blank" rel="noopener noreferrer">EFS</a> drive was selected for its cost, elasticity, and ability to be correctly shared across compute nodes.</p><p>Directories therein will contain required background data and can/will be updated as needed.</p><p>The Nextflow processing directory is called <code>nextflow</code>. This directory will be where data is stored and processed. Each individual directory within should be deleted upon process completion to reduce EFS costs. Processing directories are named after the original Mosaic project by default, allowing ease of discovery when issues arise.</p><p>This is an example overview of the current directory structure used under <code>/common</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/common</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Calypso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── GFF3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── GRCh37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── GRCh38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── GRCh37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── GRCh38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── homo_sapiens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── GRCh38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Regions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── GRCh37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── GRCh38</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── nextflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── [MOSAIC ID]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vep_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── homo_sapiens</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── 113_GRCh37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── 113_GRCh38</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="nextflow">Nextflow<a href="#nextflow" class="hash-link" aria-label="Direct link to Nextflow" title="Direct link to Nextflow">​</a></h2><p>A Nextflow helper script has been created and will be available on the HeadNode. When launched, it will ask a series of questions needed to correctly process.</p><p><strong><em>It is recommended to run this process in a screen session.</em></strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Example of running a re-annotation, helper script will change when full pipeline is implemented.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$&gt; ./calypso.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter VCF file S3 path:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter S3 path for final VCF files:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter Mosaic Project ID:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter Genomic Reference to use (GRCh38/GRCh37)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run as singleton? (true/false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script will take the collected inputs and create a Nextflow command, then it will ask if you would like to run the displayed command.</p><p>The following steps will occur:</p><ul><li>A Mosaic processing directory will be created on the headnode.</li><li>A Nextflow processing directory will be created on the EFS drive <code>/common/nextflow/[MOSAIC ID]</code> where processing output will result.</li></ul><p>Other scripts will be available on the HeadNode. Here is a brief description of the scripts that will be used and their intended functions:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">These scripts will be subject to change once the full pipeline is implemented, but are here for a brief overview.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$&gt; docker-login.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This script will be run at cluster creation and each Nextflow process. It allows correct docker login and ECR access on the compute node.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$&gt; docker-purge.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This script is used as needed to clean up any Docker builds on the HeadNode or elsewhere.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$&gt; HeadNode-setup.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># This is the main script used to build the AMI image that pcluster will use, as well as all HeadNodes and compute nodes.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/UCGD/Core-Docs/docs/docs/UCGD-Cloud/version_1.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Core-Docs/docs/UCGD-Cloud/ucgd_var_pipeline_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">VAR Pipeline Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Core-Docs/docs/UCGD-Pipeline/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#aws-setup-and-pcluster-configuration" class="table-of-contents__link toc-highlight">AWS setup and pcluster configuration</a><ul><li><a href="#iam-user-setup-for-aws-parallelcluster" class="table-of-contents__link toc-highlight">IAM User Setup for AWS ParallelCluster</a></li><li><a href="#vpc-and-subnets" class="table-of-contents__link toc-highlight">VPC and Subnets</a></li><li><a href="#pcluster" class="table-of-contents__link toc-highlight">pcluster</a></li><li><a href="#key-configurations" class="table-of-contents__link toc-highlight">Key configurations:</a></li><li><a href="#ecr" class="table-of-contents__link toc-highlight">ECR</a></li><li><a href="#efs" class="table-of-contents__link toc-highlight">EFS</a></li></ul></li><li><a href="#nextflow" class="table-of-contents__link toc-highlight">Nextflow</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">UCGD Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Core-Docs/docs/Homepage">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">UCGD Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ucgd.genetics.utah.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UCGD Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/UCGD" target="_blank" rel="noopener noreferrer" class="footer__link-item">UCGD Github page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://cores.utah.edu/ucgd/" target="_blank" rel="noopener noreferrer" class="footer__link-item">UCGD Cores Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/UCGD/Core-Docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation GitHub Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/Core-Docs/assets/js/runtime~main.386b42ae.js"></script>
<script src="/Core-Docs/assets/js/main.94abe2e7.js"></script>
</body>
</html>